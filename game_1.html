<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>game 1</title>

</head>
<body>
	<canvas id='canvas_id' width="400" height="300" style="border: 1px solid black"></canvas>
	<script>
	var log = console.log.bind(console)

	var imageFromImage = function(path){
		var image = new Image()
		image.src = path
		return image		
	}

	var Paddle = function(){
		var o = {
			image: imageFromImage('paddle.png'),
			x: 150,
			y: 250,
			speed: 10,
		}
		o.moveLeft = function(){
			o.x -= o.speed
		}
		o.moveRight = function(){
			o.x += o.speed
		}
		return o
	}

	var Ball = function(){
		var o = {
			image: imageFromImage('ball.png'),
			x: 150,
			y: 220,
			speedx: 5,
			speedy: 5,
			fired: false,
			paused: false,
		}

		o.fire = function(){
			o.fired = true
	
		}

		o.pause = function() {
			o.paused = !o.paused
		}

		o.move = function(canvas){
			if(o.paused == true) {
				return
			}
			if (o.fired == true){
				if ( o.x<0 || o.x+o.image.width > canvas.width ){
					o.speedx *= -1
				}
				if (o.y<0 || o.y+o.image.height > canvas.height) {
					o.speedy *= -1
				}
				o.y += o.speedy
				o.x += o.speedx
			}
		}
		return o
	}


	var Game = function(){
		var g = {
			keydowns:{},
			actions:{},
		}
		var canvas = document.querySelector('#canvas_id')
		var context = canvas.getContext('2d')

		g.canvas = canvas
		g.context = context

		g.draw_image = function(img_object){
			g.context.drawImage(img_object.image, img_object.x, img_object.y)
		}

		window.addEventListener('keydown', function(event){
			g.keydowns[event.key] = true
		})

		window.addEventListener('keyup', function(event){
			g.keydowns[event.key] = false
		})

		g.register = function(key, callback){
			g.actions[key] = callback
		}



		//timer
		setInterval(function(){
			//update
			var actions = Object.keys(g.actions)
			for (var i = 0; i < actions.length; i++) {
				var key = actions[i]
				if (g.keydowns[key] == true){
					g.actions[key]()
				}
			}
			g.update()	
			//clear
			context.clearRect(0, 0, canvas.width, canvas.height)
			//draw
			g.draw()

		}, 1000/30)

		return g

	}

	var _main = function() {

		var paddle = Paddle()
		var game = Game()
		var ball = Ball()

		game.register('a', function(){
			paddle.moveLeft()
		})

		game.register('d', function(){
			paddle.moveRight()
		})

		game.register(' ', function(){
			ball.fire()
		})

		game.register('b', function(){
			ball.pause()
		})


		game.update = function(){
			
			ball.move(game.canvas)

		}

		game.draw = function(){
			
			game.draw_image(paddle)
			game.draw_image(ball)
		}
		

	}

	_main()
	</script>
</body>
</html>